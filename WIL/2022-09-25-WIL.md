# AWS와 github actions를 이용한 ci/cd 자동화

## 환경
> EC2 ubuntu 20.04

## 목표 
> github actions로 빌드까지 완료 -> aws S3로 압축 파일 업로드 -> codedeploy로 EC2 인스턴스에 전달 -> 인스턴스 내에서 서버 가동
> 현재 EC2 인스턴스에 전달까지 끝났고 인스턴스 내에서 서버 가동만을 남겨둠.

## 트러블슈팅 과정
> aws codedeploy 도중에 build하려고 하니 도중에 종료되어서 github actions에서 빌드 후 S3를 거쳐 EC2에 전달하는 워크플로우로 수정. 수동배포 당시 nohup node server.js 명령어로 서버를 가동했기 때문에 codedeploy실행 시 같은 명령어로 자동 배포를 시도했습니다. 그러나 7~8번째 배포 이후로 url에 접속할 수 없었고 codedeploy log를 확인해보니 실행된 직후 terminated 되었다고 표시됨.
> 원인을 찾던 중 aws troubleshooting에 프로세스가 백그라운드에서 장시간 가동되면 오류가 있을 수 있다는 항목을 발견하여 확신하지는 못하였지만 pm2를 이용해 서버 가동 전에 해당 프로세스를 종료하고 다시 시작하는 방식으로 구현을 시도하고 있음.

## 의문점

> nginx는 웹 서버, pm2는 프로세스 관리를 위한 프로그램으로 보이는데 둘을 함께 사용할 경우 nginx는 리버스 프록시, pm2는 server.js 파일을 지속적으로 가동하는 역할을 각각 담당함. 
> 반면 구글링시 nginx만을 사용해 80 포트로 접속했을 때 일정 경로의 html파일을 보여주는 식으로 배포한 사례를 보았는데 이 방식이 정적 웹 호스팅에 해당하는 게 맞는지 확인중
